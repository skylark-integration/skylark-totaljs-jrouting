/**
 * skylark-totaljs-jrouting - A version of totaljs-jrouting.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jrouting/
 * @license MIT
 */
!function(t,r){var n=r.define,e=r.require,i="function"==typeof n&&n.amd,o=!i&&"undefined"!=typeof exports;if(!i&&!n){var s={};n=r.define=function(t,r,n){"function"==typeof n?(s[t]={factory:n,deps:r.map(function(r){return function(t,r){if("."!==t[0])return t;var n=r.split("/"),e=t.split("/");n.pop();for(var i=0;i<e.length;i++)"."!=e[i]&&(".."==e[i]?n.pop():n.push(e[i]));return n.join("/")}(r,t)}),exports:null},e(t)):s[t]=n},e=r.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var n=s[t];if(!n.exports){var i=[];n.deps.forEach(function(t){i.push(e(t))}),n.exports=n.factory.apply(r,i)}return n.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,r){t("skylark-totaljs-jrouting/jR",["skylark-utils-dom/query"],function(t){var r={},n={LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100,version:"v3.0.0",cache:{},routes:[],history:[],errors:[],events:{},eventsOnce:{},global:{},query:{},params:[],middlewares:{},repository:{},url:"",model:null,isFirst:!0,isReady:!1,isRefresh:!1,isModernBrowser:!!history.pushState,hashtags:!1,count:0};return window.jR||(window.jR=n),window.jRouting||(window.jRouting=n),window.JRFU||(window.JRFU=r),n.remove=function(t){for(var r=[],n=0,e=this.routes.length;n<e;n++)this.routes[n].id!==t&&r.push(this.routes[n]);return this.routes=r,this},n.on=function(t,r){var n=this.events[t];return n?n.push(r):this.events[t]=[r],this},n.once=function(t,r){var n=this.eventsOnce[t];return n?n.push(r):this.eventsOnce[t]=[r],this},n.emit=function(t){var r=this.events[t]||[],n=this.eventsOnce[t]||[],e=r.length,i=n.length;if(!e&&!i)return this;for(var o=[],s=arguments.length,a=1;a<s;a++)o.push(arguments[a]);if(e>0)for(var a=0;a<e;a++)r[a].apply(this,o);if(i){for(var a=0;a<e;a++)n[a].apply(this,o);delete this.eventsOnce[t]}},n.route=function(t,r,e,i){if(r instanceof Array){var o=e;e=r,r=o}"function"==typeof e&&(o=i,i=e,e=o);var s=t.count("/")+(-1===t.indexOf("*")?0:10),a=n._route(t.trim()),u=[];"string"==typeof e&&(e=e.split(","));var l=[],h=[],f={};if(e instanceof Array&&e.forEach(function(t){"object"==typeof t?f=t:"@"===t.substring(0,1)?h.push(t.substring(1)):l.push(t)}),-1!==t.indexOf("{")){s-=100;for(var c=0;c<a.length;c++)"{"===a[c].substring(0,1)&&u.push(c);s-=u.length}return n.remove(t),n.routes.push({id:t,url:a,fn:r,priority:s,params:u,middleware:l.length?l:null,init:i,count:0,pending:!1,options:f,roles:h}),n.routes.sort(function(t,r){return t.priority>r.priority?-1:t.priority<r.priority?1:0}),n},n.middleware=function(t,r){return this.middlewares[t]=r,this},n.refresh=function(){return this.location(this.url,!0)},n.reload=function(){return n.refresh()},n.async=function(){if(window.jRoute&&window.jRoute.length){for(;;){var t=window.jRoute.shift();if(!t)break;t()}n.is404&&n.location(n.url)}},n._route=function(t){47===t.charCodeAt(0)&&(t=t.substring(1)),47===t.charCodeAt(t.length-1)&&(t=t.substring(0,t.length-1));var r=t.split("/");return 1!==r.length||r[0]||(r[0]="/"),r},n._route_param=function(t,r){var n=[];if(!r||!t)return n;var e=r.params.length;if(e)for(var i=0;i<e;i++){var o=t[r.params[i]];n.push("/"===o?"":o)}return n},n._route_compare=function(t,r){var n=t.length,e=1===n&&"/"===t[0];if(r.length!==n)return!1;for(var i=0;i<n;i++){var o=r[i];if(!o)return!1;if(e||123!==o.charCodeAt(0)){if("*"===o)return!0;if(t[i]!==o)return!1}}return!0},n.location=function(t,e){if(n.isReady){var i=t.indexOf("?");-1!==i&&(t=t.substring(0,i)),t=r.prepareUrl(t),t=r.path(t);var o=this,s=o._route(t),a=[],u=!0,l=[];l.push.apply(l,s);for(var h=0,f=s.length;h<f;h++)s[h]=s[h].toLowerCase();o.isRefresh=e||!1,o.count++,!e&&o.url.length&&o.history[o.history.length-1]!==o.url&&(o.history.push(o.url),o.history.length>o.LIMIT_HISTORY&&o.history.shift());for(var f=o.routes.length,h=0;h<f;h++){var c=o.routes[h];if(o._route_compare(s,c.url)&&(-1===c.url.indexOf("*")&&(u=!1),!(c.once&&c.count>0))){c.count++,a.push(c);break}}o.url.length&&(o.cache[o.url]=o.repository),o.url=t,o.repository=o.cache[t],o.repository||(o.repository={}),o._params(),o.params=o._route_param(l,c),o.is404=!1,o.emit("location",t),f=a.length;for(var h=0;h<f;h++){var c=a[h];if(!c.pending)if(c.middleware&&c.middleware.length)!function(t){for(var r=t.middleware.length,e=[],i=0;i<r;i++){var o=n.middlewares[t.middleware[i]];o&&function(t,r){e.push(function(e){r.call(n,e,t.options,t.roles,t)})}(t,o)}if(!t.init)return t.pending=!0,void e.middleware(function(r){!r&&t.fn.apply(n,n.params),t.pending=!1},t);t.pending=!0,t.init(function(){e.middleware(function(r){!r&&t.fn.apply(n,n.params),t.pending=!1},t)}),t.init=null}(c);else{if(!c.init){c.fn.apply(o,o.params);continue}c.pending=!0,function(t){t.init(function(){t.fn.apply(o,o.params),t.pending=!1})}(c),c.init=null}}o.is404=!0,u&&o.status(404,new Error("Route not found."))}},n.prev=function(){return this.history[this.history.length-1]},n.back=function(){var t=this.history.pop()||"/";return this.url="",this.redirect(t,!0),this},n.status=function(t,r){return this.emit("status",t||404,r),this},n.redirect=function(t,r){return 35===t.charCodeAt(0)?(location.hash=t,this.model=r||null,this.location(t,!1),this):this.isModernBrowser?(history.pushState(null,null,t),this.model=r||null,this.location(t,!1),this):(location.href=t,!1)},n._params=function(){for(var t={},r=location.href.slice(location.href.indexOf("?")+1).split("&"),n=0;n<r.length;n++){var e=r[n].split("=");if(2===e.length){var i=decodeURIComponent(e[0]),o=decodeURIComponent(e[1]),s=t[i]instanceof Array;t[i]&&!s&&(t[i]=[t[i]]),s?t[i].push(o):t[i]=o}}return this.query=t,this},n.path=r.path=function(t,r){if("#"===t.substring(0,1))return t;r||(r="/");var n=t.indexOf("?"),e="";-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.length,o=t.substring(i-1,i);return o!==r&&(t+=r),t+e},r.prepareUrl=function(t){if("#"===t.substring(0,1))return t;var r=t.indexOf("#");return-1!==r?t.substring(0,r):t},Array.prototype.middleware||(Array.prototype.middleware=function(t,r){var n=this,e=n.shift();return void 0===e?(t&&t(),n):(e(function(e){e instanceof Error||!1===e?t&&t(!1===e||e):setTimeout(function(){n.middleware(t,r)},1)},r.options,r.roles),n)}),String.prototype.count||(String.prototype.count=function(t){var r=0,n=0;do{(r=this.indexOf(t,r+t.length))>0&&n++}while(r>0);return n}),n.on("error",function(t,r,n){this.errors.push({error:t,url:r,name:n,date:new Date}),this.errors.length>this.LIMIT_HISTORY_ERROR&&this.errors.shift()}),n.clientside=function(r){return t(document).on("click",r,function(r){r.preventDefault();var e=t(this);n.redirect(e.attr("href")||e.attr("data-jrouting")||e.attr("data-jr"))}),n},n.async(),t.fn.jRouting=function(r){if(n.hashtags||!n.isModernBrowser)return this;var e=+t.fn.jquery.replace(/\./g,"");if(e>=300&&!0===r)throw Error("$(selector).jRouting() doesn't work in jQuery +3. Instead of this use jR.clientside(selector).");var i=function(r){r.preventDefault(),n.redirect(t(this).attr("href"))};return r?t(document).on("click",this.selector,i):this.filter("a").bind("click",i),this},t(document).ready(function(){n.async(),n.hashtags?n.url=location.hash||r.path(r.prepareUrl(location.pathname)):n.url=r.path(r.prepareUrl(location.pathname)),n.events.ready?(n.emit("ready",n.url),n.emit("load",n.url)):setTimeout(function(){n.isReady=!0,n.location(n.url),n.emit("ready",n.url),n.emit("load",n.url)},5),t(window).on("hashchange",function(){n.isReady&&n.hashtags&&n.location(r.path(location.hash))}),t(window).on("popstate",function(){if(n.isReady&&!n.hashtags){var t=r.path(location.pathname);n.url!==t&&n.location(t)}})}),n}),t("skylark-totaljs-jrouting/globals",["./jR","./jR"],function(t){return t.globals=function(){var t=window;return t.jR=jR,t.ROUTE=function(t,r,n,e){return jR.route(t,r,n,e)},setTimeout(jR.async,500),setTimeout(jR.async,1e3),setTimeout(jR.async,2e3),setTimeout(jR.async,3e3),setTimeout(jR.async,5e3),t}}),t("skylark-totaljs-jrouting/main",["./jR","./globals"],function(t){return t}),t("skylark-totaljs-jrouting",["skylark-totaljs-jrouting/main"],function(t){return t})}(n),!i){var a=e("skylark-langx/skylark");o?module.exports=a:r.skylarkjs=a}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-totaljs-jrouting.js.map
